version: 2.1

orbs:
  node: circleci/node@4.1.0

executors:
  node_executor:
    docker:
      - image: cimg/node:14.17.0  # Updated to use CircleCI's next-gen convenience images
    working_directory: ~/react

jobs:
  setup:
    executor: node_executor
    steps:
      - checkout
      - node/install:
          node-version: "14.17.0"  # Specify Node version here if needed, or use the image's default
      - run: npm install
      - run: npm run dll
      - run:
          name: List installed packages
          command: npm ls || true  # Simplified command
      - persist_to_workspace:
          root: ~/react
          paths:
            - node_modules

  # Uncomment and update the testing job as needed
  # testing:
  #   executor: node_executor
  #   steps:
  #     - checkout
  #     - attach_workspace:
  #         at: ~/react
  #     - run: npm run test  # Assuming "testing" is a custom script; replace with actual command
  #     - run: node ./scripts/webpack.testing.config.js
  #     - persist_to_workspace:
  #         root: ~/react
  #         paths:
  #           - dist

  lint:
    executor: node_executor
    steps:
      - checkout
      - attach_workspace:
          at: ~/react
      - run: npm run lint

workflows:
  version: 2
  build_and_lint:
    jobs:
      - setup
      # - testing:  # Uncomment if testing job is to be included
      #     requires:
      #       - setup
      - lint:
          requires:
            - setup
  nightly_build:
    triggers:
      - schedule:
          cron: "0 0 * * *"
          filters:
            branches:
              only:
                - master
    jobs:
      - setup
      # - testing:  # Uncomment if testing job is to be included
      #     requires:
      #       - setup
      - lint:
          requires:
            - setup
